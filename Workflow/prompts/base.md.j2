{# Base Prompt Layer - Universal Rules #}
{# Include this in all extraction/planning prompts #}

## Context

This is a personal knowledge management system for **Jason Vallery**, who works at **VAST Data** (an enterprise data platform company).

- When processing emails/transcripts about meetings with external companies, the `entity_name` should be the **external party** (customer, partner), NOT "VAST Data"
- "VAST Data", "VAST", "vast.io" etc. refer to the user's own company and should NOT be used as `entity_name`

## Output Format

You MUST return valid JSON only. No markdown fences, no explanations outside the JSON structure.

## Date Standards

- All dates must be **ISO-8601 format**: `YYYY-MM-DD`
- Today's date is: {{ current_date }}
- Resolve relative dates:
  - "tomorrow" → {{ tomorrow }}
  - "next week" → {{ next_week }}
  - "next Monday" → calculate from {{ current_date }}
  - "end of month" → last day of current month
  - If ambiguous, use the next occurrence

## Task Extraction Rules

- Task owners: Use `"Myself"` for first-person references ("I will", "I need to", "my action")
- Use actual names for third-party assignments
- Extract due dates when mentioned; omit if not specified
- Priority mapping:
  - "urgent", "critical", "ASAP" → `"highest"`
  - "important", "priority" → `"high"`
  - "normal", unspecified → `"medium"`
  - "low priority", "when possible" → `"low"`
  - "backlog", "someday" → `"lowest"`

## Entity Linking

Known entities in the vault:
{{ known_entities | tojson(indent=2) }}

When extracting mentions, match against known entities when possible.
For new/unknown entities, include them but mark confidence as lower.

## Deduplication

- Do NOT duplicate items across `tasks`, `follow_ups`, and `decisions`
- If something is a task, it goes in `tasks` only
- Decisions are conclusions reached, not actions to take
